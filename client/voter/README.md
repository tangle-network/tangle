## Tangle Voter CLI

A simple CLI tool for voting for changing the current Signature Bridge governor.

### Build

```
cargo build --release -p tangle-voter
```

### How to use the CLI

```bash
Usage: tangle-voter <COMMAND>

Commands:
  vote                   Vote for a candidate
  decode                 Decode DKG Refresh Proposal
  public-key-to-address  Convert a public key to an EVM address
  cast                   Cast votes to change the governor
  help                   Print this message or the help of the given subcommand(s)

Options:
  -h, --help     Print help
  -V, --version  Print version
```

#### Create a vote by inspecting the refresh proposal:

```bash
Decode DKG Refresh Proposal

Usage: tangle-voter decode <REFRESH_PROPOSAL>

Arguments:
  <REFRESH_PROPOSAL>  The DKG Refresh Proposal

Options:
  -h, --help  Print help
```

* Example:

```bash
./target/release/tangle-voter decode 0xf1c4e1761995f0af42348430cc9d1f18d3100f78335734b1e016748249f9f7bc000000000149970000000008000001763aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80
```

You should see the following output:

```
Decoded Refresh Proposal:
{
  "voter_merkle_root": "0xf1c4e1761995f0af42348430cc9d1f18d3100f78335734b1e016748249f9f7bc",
  "average_session_length_in_millisecs": 21600000,
  "voter_count": 8,
  "nonce": 374,
  "public_key": "0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80"
}
```
#### Get the new governor's address from the public key:

```bash
Convert a public key to an EVM address

Usage: tangle-voter public-key-to-address <PUBLIC_KEY>

Arguments:
  <PUBLIC_KEY>  The public key

Options:
  -h, --help  Print help
```

* Example:

```bash
./target/release/tangle-voter public-key-to-address 0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80
```

Which will result in the following output:

```
Address: 0x64cfb1fa0fa7da3da0097fee9d9ab546b9bcd029
```

#### Vote for the new governor:

```bash
Vote for a candidate

Usage: tangle-voter vote --leaf-index <LEAF_INDEX> --node <SIBLING_PATH_NODES> --proposed-governor <PROPOSED_GOVERNOR>

Options:
      --leaf-index <LEAF_INDEX>
          The index of the leaf node in the Merkle tree
      --node <SIBLING_PATH_NODES>
          The path to the leaf node in the Merkle tree. Can be specified multiple times
      --proposed-governor <PROPOSED_GOVERNOR>
          The address of the candidate
  -h, --help
          Print help
```

* Example:

```bash
./target/release/tangle-voter vote --leaf-index 1 --node 0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7 --node 0x9933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000 --proposed-governor 0x64cfb1fa0fa7da3da0097fee9d9ab546b9bcd029
```

You should see the following output:

```
{
  "leaf_index": 1,
  "proposed_governor": "0x64cfb1fa0fa7da3da0097fee9d9ab546b9bcd029",
  "sibling_path_nodes": [
    [ ... ],
    [ ... ]
  ]
}
Please Sign the following using your `wdkg` ECDSA key:
Encoded Vote: 000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000
```

You should then sign the encoded vote value using your `wdkg` ECDSA Key then save the signature.

4. Create the vote transaction:

```bash
Cast votes to change the governor

Usage: tangle-voter cast --vote <VOTE> --signature <SIGNATURE>

Options:
      --vote <VOTE>
      --signature <SIGNATURE>
  -h, --help                   Print help
```

* Example:

```bash
./target/release/tangle-voter cast \
    --vote 000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000 \
    --signature 0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80 \
    --vote 000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000 \
    --signature 0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80
```

Finally it will print the transaction that you can use [`cast`](https://book.getfoundry.sh/cast/) to send it to the signature bridge smart contract.

```
  {
  "votes": [
    {
      "leaf_index": 1,
      "proposed_governor": "0x64cfb1fa0fa7da3da0097fee9d9ab546b9bcd029",
      "sibling_path_nodes": [
        [ ... ],
        [ ... ]
      ]
    },
    {
      "leaf_index": 1,
      "proposed_governor": "0x64cfb1fa0fa7da3da0097fee9d9ab546b9bcd029",
      "sibling_path_nodes": [
        [ ... ],
        [ ... ]
      ]
    }
  ],
  "sigs": [
    "0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80",
    "0x3aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80"
  ]
}
Please use `cast tx` to send this tx to the signature bridge:
Call: 0x957b49a100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000403aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000000000000000000000000000000000000000000000000000000000000000403aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80
```
Then using `cast`

```bash
cast send 0x... --rpc <RPC_URL> -i 0x957b49a100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000064cfb1fa0fa7da3da0097fee9d9ab546b9bcd029000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000023aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df79933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000403aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f8000000000000000000000000000000000000000000000000000000000000000403aceb11481f6467fd856079bd7c978401003f15aa55974807e138d58ac929df7599933fd36121dd6d419faa80ef8f6d32898e3df88f32b6e10d82e4434a00f80
```
